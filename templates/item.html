{% extends "base.html" %} {% block title %}{{ item.title }} · winter{% endblock
%} {% block content %}
<div class="row g-4">
  <div class="col-lg-6">
    <div class="card">
      <img
        class="item-img"
        src="https://picsum.photos/seed/item-{{ item.id }}/900/600"
        alt="{{ item.title }}"
        data-fallback="{{ url_for('static', filename='placeholder.jpg') }}"
        onerror="this.onerror=null; this.src=this.dataset.fallback;"
      />
      <div class="card-body">
        <h3 class="card-title">{{ item.title }}</h3>
        <div class="mb-2">
          {% if item.class_name %}<span class="badge-soft me-2"
            ><i class="bi bi-tag"></i> {{ item.class_name }}</span
          >{% endif %} {% if item.department_name %}<span class="badge-soft"
            ><i class="bi bi-grid"></i> {{ item.department_name }}</span
          >{% endif %}
        </div>
        <p class="text-secondary">{{ item.description }}</p>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card p-3 p-md-4">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="m-0">Reviews</h5>
        <a
          class="btn btn-primary btn-sm"
          href="{{ url_for('new_review', item_id=item.id) }}"
        >
          <i class="bi bi-plus-lg"></i> Add review
        </a>
      </div>

      {% if not reviews %}
      <div class="text-secondary">No reviews yet — be the first!</div>
      {% else %} {% set avg = (reviews|map(attribute='rating')|sum /
      (reviews|length)) %}
      <div class="mb-3">
        <div class="stars">
          {% for i in range(1,6) %} {% if i <= avg|round(0,'floor') %}
          <i class="bi bi-star-fill"></i>
          {% elif i - avg < 1 %}
          <i class="bi bi-star-half"></i>
          {% else %}
          <i class="bi bi-star"></i>
          {% endif %} {% endfor %}
        </div>
        <div class="small text-secondary">
          {{ reviews|length }} review(s), average {{ "%.1f"|format(avg) }}/5
        </div>
      </div>

      {% for r in reviews %}
      <div class="review">
        <div class="d-flex align-items-center justify-content-between">
          <div class="stars">
            {% for i in range(1,6) %}
            <i
              class="bi {{ 'bi-star-fill' if i <= r.rating else 'bi-star' }}"
            ></i>
            {% endfor %}
          </div>
          <div class="small text-secondary">
            {{ r.created_at.strftime("%Y-%m-%d %H:%M") }}
          </div>
        </div>
        {% if r.title %}
        <div class="fw-semibold mt-2">{{ r.title }}</div>
        {% endif %}
        <p class="mb-2 mt-1">{{ r.body }}</p>
        <div class="small">
          <span class="badge-soft me-2"
            >Recommended: {{ 'Yes (1)' if r.recommend_label==1 else 'No (0)'
            }}</span
          >
          <span class="text-secondary"
            >Model suggested: {{ r.model_suggested }}</span
          >
          ·
          <a
            class="text-decoration-none"
            href="{{ url_for('review_detail', review_id=r.id) }}"
            >Permalink</a
          >
        </div>
      </div>
      {% endfor %} {% endif %}
    </div>
  </div>
</div>
{% endblock %}
